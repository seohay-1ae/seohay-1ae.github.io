<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>ë°°ìœ¨ë³„ í™•ë¥  ìŠ¬ë¡¯ë¨¸ì‹ </title>
        <style>
            html,
            body {
                height: 100%;
                margin: 0;
            }
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
                padding: 20px;
                font-family: Arial, sans-serif;
                background: #f0f0f0;
                max-width: 650px;
                margin: 0 auto;
                box-sizing: border-box;
            }
            #slot-machine {
                display: flex;
                gap: 10px;
                margin: 20px 0;
            }
            .slot {
                width: 80px;
                height: 80px;
                border: 3px solid #333;
                border-radius: 10px;
                overflow: hidden;
                background: #eee;
            }
            .slot img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            #slot-trigger {
                padding: 15px 40px;
                font-size: 20px;
                cursor: pointer;
                border: none;
                border-radius: 10px;
                background-color: #28a745;
                color: white;
                margin-bottom: 20px;
            }
            #slot-trigger:disabled {
                background-color: #aaa;
                cursor: default;
            }
            #slot-credits {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            #bet-container {
                display: flex;
                gap: 10px;
                align-items: center;
                font-weight: bold;
                font-size: 18px;
                margin-bottom: 10px;
            }
            table {
                border-collapse: collapse;
                margin-top: 20px;
                font-size: 14px;
                background: white;
            }
            th,
            td {
                border: 1px solid #ccc;
                padding: 8px 10px;
                text-align: center;
            }
            th {
                background-color: #ddd;
            }
            tbody tr.highlight {
                background-color: #fff9c4;
                animation: pulse 2s ease-in-out;
            }
            @keyframes pulse {
                0% {
                    background-color: #fff9c4;
                }
                50% {
                    background-color: #ffeb3b;
                }
                100% {
                    background-color: #fff9c4;
                }
            }
        </style>
    </head>
    <body>
        <div id="bet-container">
            <span>ë°°íŒ… ë°°ìœ¨:</span>
            <label><input type="radio" name="bet" value="1" checked /> x1</label>
            <label><input type="radio" name="bet" value="5" /> x5</label>
            <label><input type="radio" name="bet" value="10" /> x10</label>
        </div>

        <div id="slot-machine">
            <div class="slot">
                <img id="wheel1" src="../static/images/suika/duri.png" alt="slot1" />
            </div>
            <div class="slot">
                <img id="wheel2" src="../static/images/suika/duri.png" alt="slot2" />
            </div>
            <div class="slot">
                <img id="wheel3" src="../static/images/suika/duri.png" alt="slot3" />
            </div>
        </div>

        <button id="slot-trigger">Spin!</button>
        <div id="slot-credits">Credits: 15</div>

        <table>
            <thead>
                <tr>
                    <th>ì¡°í•© ì¡°ê±´</th>
                    <th>ë³´ìƒ ë°°ìœ¨</th>
                    <th>x1 í™•ë¥ </th>
                    <th>x5 í™•ë¥ </th>
                    <th>x10 í™•ë¥ </th>
                    <th>ì„¤ëª…</th>
                </tr>
            </thead>
            <tbody>
                <tr id="row-duri3">
                    <td>duri 3ì¥ (ì­íŒŸ)</td>
                    <td>x100</td>
                    <td>0.2%</td>
                    <td>0.1%</td>
                    <td>0.05%</td>
                    <td>ê³ ë°°ìœ¨ì¼ìˆ˜ë¡ ë‹¹ì²¨ ì–´ë ¤ì›€</td>
                </tr>
                <tr id="row-duri2">
                    <td>duri 2ì¥</td>
                    <td>x10</td>
                    <td>4%</td>
                    <td>2%</td>
                    <td>1%</td>
                    <td>í¬ê·€ ë³´ìƒ</td>
                </tr>
                <tr id="row-normal3">
                    <td>ì¼ë°˜ 3ì¥</td>
                    <td>x5</td>
                    <td>10%</td>
                    <td>8%</td>
                    <td>5%</td>
                    <td>ì¤‘ê°„ ë³´ìƒ</td>
                </tr>
                <tr id="row-normal2">
                    <td>ì¼ë°˜ 2ì¥</td>
                    <td>x1</td>
                    <td>50%</td>
                    <td>40%</td>
                    <td>30%</td>
                    <td>ìì£¼ ë‚˜ì˜´</td>
                </tr>
                <tr id="row-lose">
                    <td>ëª¨ë‘ ë‹¤ë¦„ (ê½)</td>
                    <td>x0</td>
                    <td>35.8%</td>
                    <td>49.9%</td>
                    <td>63.95%</td>
                    <td>ë‚˜ë¨¸ì§€ í™•ë¥ </td>
                </tr>
            </tbody>
        </table>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(function () {
                let credits = 15;
                let spinning = false;

                const allSymbols = [
                    "duri",
                    "chunggyo",
                    "dongwook",
                    "jeongmin",
                    "youngbum",
                    "soyun",
                    "younggeon-with-teacher",
                    "younggeon-side",
                    "younggeon-front",
                    "teacher",
                ];

                const outcomeProbabilitiesTable = {
                    1: [
                        { type: "duri3", prob: 0.002 },
                        { type: "duri2", prob: 0.04 },
                        { type: "normal3", prob: 0.1 },
                        { type: "normal2", prob: 0.5 },
                        { type: "lose", prob: 0.358 },
                    ],
                    5: [
                        { type: "duri3", prob: 0.001 },
                        { type: "duri2", prob: 0.02 },
                        { type: "normal3", prob: 0.08 },
                        { type: "normal2", prob: 0.4 },
                        { type: "lose", prob: 0.499 },
                    ],
                    10: [
                        { type: "duri3", prob: 0.0005 },
                        { type: "duri2", prob: 0.01 },
                        { type: "normal3", prob: 0.05 },
                        { type: "normal2", prob: 0.3 },
                        { type: "lose", prob: 0.6395 },
                    ],
                };

                // í¬ë ˆë”§ ì—…ë°ì´íŠ¸
                function updateCredits(delta) {
                    credits += delta;
                    if (credits < 0) credits = 0;
                    $("#slot-credits").text("Credits: " + credits);
                }

                function getBetMultiplier() {
                    return Number($("input[name='bet']:checked").val());
                }

                // ë‹¹ì²¨ íƒ€ì… ëœë¤ ì¶”ì¶œ (ëˆ„ì  í™•ë¥ )
                function getRandomOutcome(betMultiplier) {
                    const outcomes = outcomeProbabilitiesTable[betMultiplier];
                    const r = Math.random();
                    let sum = 0;
                    for (const outcome of outcomes) {
                        sum += outcome.prob;
                        if (r < sum) {
                            return outcome.type;
                        }
                    }
                    return "lose";
                }

                // í…Œì´ë¸” í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜
                function highlightTableRow(outcomeType) {
                    // ëª¨ë“  í–‰ì˜ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                    $("tbody tr").removeClass("highlight");

                    // í•´ë‹¹ ê²°ê³¼ì˜ í–‰ì— í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€
                    const targetRow = $("#row-" + outcomeType);
                    if (targetRow.length) {
                        targetRow.addClass("highlight");
                    }
                }

                // ë‹¹ì²¨ íƒ€ì…ë³„ ì‹¬ë³¼ ì„¸íŒ…
                function setSymbolsForOutcome(type) {
                    switch (type) {
                        case "duri3":
                            return ["duri", "duri", "duri"];
                        case "duri2": {
                            // duri 2ì¥ + 1ì¥ ì¼ë°˜ ì‹¬ë³¼
                            const normalSymbols = allSymbols.filter((s) => s !== "duri");
                            const normal = normalSymbols[Math.floor(Math.random() * normalSymbols.length)];
                            // ì„ì–´ì„œ ë¦¬í„´
                            return shuffleArray(["duri", "duri", normal]);
                        }
                        case "normal3": {
                            // ì¼ë°˜ ì‹¬ë³¼ 3ì¥ ë™ì¼
                            const normalSymbols = allSymbols.filter((s) => s !== "duri");
                            const sym = normalSymbols[Math.floor(Math.random() * normalSymbols.length)];
                            return [sym, sym, sym];
                        }
                        case "normal2": {
                            // ì¼ë°˜ ì‹¬ë³¼ 2ì¥ + 1ì¥ ë‹¤ë¥¸ ì‹¬ë³¼ (ê½ ì œì™¸)
                            const normalSymbols = allSymbols.filter((s) => s !== "duri");
                            const sym1 = normalSymbols[Math.floor(Math.random() * normalSymbols.length)];
                            let sym2;
                            do {
                                sym2 = normalSymbols[Math.floor(Math.random() * normalSymbols.length)];
                            } while (sym2 === sym1);
                            const arr = [sym1, sym1, sym2];
                            return shuffleArray(arr);
                        }
                        case "lose":
                        default: {
                            // ëª¨ë‘ ë‹¤ë¦„ (ê½)
                            const symbols = [];
                            while (symbols.length < 3) {
                                const sym = allSymbols[Math.floor(Math.random() * allSymbols.length)];
                                if (!symbols.includes(sym)) {
                                    symbols.push(sym);
                                }
                            }
                            return symbols;
                        }
                    }
                }

                // ë°°ì—´ ì…”í”Œ í•¨ìˆ˜
                function shuffleArray(arr) {
                    for (let i = arr.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [arr[i], arr[j]] = [arr[j], arr[i]];
                    }
                    return arr;
                }

                // ìŠ¬ë¡¯ ì• ë‹ˆë©”ì´ì…˜ (ê°„ë‹¨)
                function spinAnimation(symbols, callback) {
                    const spinTimes = 25;
                    let count = 0;

                    const interval = setInterval(() => {
                        const randomSymbols = [
                            allSymbols[Math.floor(Math.random() * allSymbols.length)],
                            allSymbols[Math.floor(Math.random() * allSymbols.length)],
                            allSymbols[Math.floor(Math.random() * allSymbols.length)],
                        ];
                        for (let i = 0; i < 3; i++) {
                            $("#wheel" + (i + 1)).attr("src", "../static/images/suika/" + randomSymbols[i] + ".png");
                        }
                        count++;
                        if (count >= spinTimes) {
                            clearInterval(interval);
                            // ìµœì¢… ì‹¬ë³¼ ì„¸íŒ…
                            for (let i = 0; i < 3; i++) {
                                $("#wheel" + (i + 1)).attr("src", "../static/images/suika/" + symbols[i] + ".png");
                            }
                            // ë Œë”ë§ì„ ìœ„í•´ ì§§ì€ ë”œë ˆì´ í›„ ì½œë°± í˜¸ì¶œ
                            setTimeout(callback, 100);
                        }
                    }, 60); // ë”œë ˆì´ë¥¼ 80ì—ì„œ 60ìœ¼ë¡œ ì¤„ì—¬ì„œ ì „ì²´ ì‹œê°„ì€ ë” ê¸¸ë©´ì„œë„ ë¶€ë“œëŸ½ê²Œ
                }

                $("#slot-trigger").on("click", function () {
                    if (spinning) return;

                    const betMultiplier = getBetMultiplier();
                    if (credits < betMultiplier) {
                        alert("í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
                        return;
                    }

                    spinning = true;
                    updateCredits(-betMultiplier);
                    $("#slot-trigger").prop("disabled", true);

                    const outcomeType = getRandomOutcome(betMultiplier);
                    const symbols = setSymbolsForOutcome(outcomeType);

                    spinAnimation(
                        symbols,
                        () => {
                            // í…Œì´ë¸” í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€
                            highlightTableRow(outcomeType);

                            // ë¸Œë¼ìš°ì €ê°€ í™”ë©´ì„ ìƒˆë¡œ ê·¸ë¦¬ë„ë¡ ê°•ì œ
                            requestAnimationFrame(() => {
                                requestAnimationFrame(() => {
                                    // ë³´ìƒ ì²˜ë¦¬
                                    let message;
                                    let creditsWon = 0;

                                    switch (outcomeType) {
                                        case "duri3":
                                            creditsWon = 100 * betMultiplier;
                                            message = `ğŸ‰ ì­íŒŸ!! duri 3ê°œ!! ${creditsWon} í¬ë ˆë”§!`;
                                            break;
                                        case "duri2":
                                            creditsWon = 10 * betMultiplier;
                                            message = `âœ¨ duri 2ì¥! ${creditsWon} í¬ë ˆë”§!`;
                                            break;
                                        case "normal3":
                                            creditsWon = 5 * betMultiplier;
                                            message = `ğŸ”¥ ì¼ë°˜ ì‹¬ë³¼ 3ì¥! ${creditsWon} í¬ë ˆë”§!`;
                                            break;
                                        case "normal2":
                                            creditsWon = 1 * betMultiplier;
                                            message = `ğŸ˜Š ì¼ë°˜ ì´ë¯¸ì§€ 2ì¥! ì‚¬ìš© í¬ë ˆë”§ í™˜ê¸‰ (${creditsWon})`;
                                            break;
                                        case "lose":
                                        default:
                                            message = "ğŸ˜¢ ì•„ì‰½ë„¤ìš”. ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!";
                                            break;
                                    }

                                    // alertë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                                    alert(message);

                                    // ì‚¬ìš©ìê°€ 'í™•ì¸'ì„ ëˆ„ë¥´ë©´ ì•„ë˜ ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.
                                    $("tbody tr").removeClass("highlight"); // í•˜ì´ë¼ì´íŠ¸ ì œê±°
                                    updateCredits(creditsWon);

                                    spinning = false;
                                    $("#slot-trigger").prop("disabled", false);
                                });
                            });
                        },
                        500
                    );
                });
            });
        </script>
    </body>
</html>
